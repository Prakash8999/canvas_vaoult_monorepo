{
  "version": 3,
  "sources": ["../../../../../src/jobs/otp.worker.ts"],
  "sourcesContent": ["// worker/otp.worker.ts\r\nimport { Worker } from 'bullmq';\r\nimport { sendMail } from '../common/libs/emails/email';\r\nimport { authOtpEmailTemp, passwordResetOtpEmailTemp, passwordResetLinkEmailTemp } from '../common/libs/emails/template';\r\n\r\n\r\nexport const otpWorker = new Worker('send-otp', async (job) => {\r\n\t\r\n  const { email, otp } = job.data;\r\n\r\n  try {\r\n    console.log(`Sending OTP ${otp} to email ${email}`);\r\n    const result = await sendMail(email, `Your CanvasVault OTP`, authOtpEmailTemp(otp, true));\r\n    console.log(result)\r\n\treturn true;\r\n  } catch (err) {\r\n    // throw to trigger BullMQ retry/backoff\r\n    throw err;\r\n  }\r\n}, { \r\n  // Use `url` when REDIS_HOST is a full redis URL (e.g. redis://localhost:6379).\r\n  // Passing the full URL into `host` causes DNS lookups for the literal string.\r\n  connection: { url: process.env.REDIS_HOST } \r\n});\r\n\r\nexport const passwordResetOtpWorker = new Worker('send-password-reset-otp', async (job) => {\r\n  const { email, otp } = job.data;\r\n\r\n  try {\r\n    console.log(`Sending password reset OTP ${otp} to email ${email}`);\r\n    const result = await sendMail(email, `Reset Your CanvasVault Password`, passwordResetOtpEmailTemp(otp));\r\n    console.log(result);\r\n    return true;\r\n  } catch (err) {\r\n    // throw to trigger BullMQ retry/backoff\r\n    throw err;\r\n  }\r\n}, {\r\n  connection: { url: process.env.REDIS_HOST }\r\n});\r\n\r\nexport const passwordResetLinkWorker = new Worker('send-password-reset-link', async (job) => {\r\n  const { email, resetLink } = job.data;\r\n\r\n  try {\r\n    console.log(`Sending password reset link to email ${email}`);\r\n    const result = await sendMail(email, `Reset Your CanvasVault Password`, passwordResetLinkEmailTemp(resetLink));\r\n    console.log(result);\r\n    return true;\r\n  } catch (err) {\r\n    // throw to trigger BullMQ retry/backoff\r\n    throw err;\r\n  }\r\n}, {\r\n  connection: { url: process.env.REDIS_HOST }\r\n});\r\n\r\notpWorker.on('failed', (job, err) => {\r\n  // log or push to dead-letter queue if attempts exhausted\r\n});\r\n\r\npasswordResetOtpWorker.on('failed', (job, err) => {\r\n  // log or push to dead-letter queue if attempts exhausted\r\n});\r\n\r\npasswordResetLinkWorker.on('failed', (job, err) => {\r\n  // log or push to dead-letter queue if attempts exhausted\r\n});\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAAuB;AACvB,mBAAyB;AACzB,sBAAwF;AAGjF,MAAM,YAAY,IAAI,qBAAO,YAAY,OAAO,QAAQ;AAE7D,QAAM,EAAE,OAAO,IAAI,IAAI,IAAI;AAE3B,MAAI;AACF,YAAQ,IAAI,eAAe,GAAG,aAAa,KAAK,EAAE;AAClD,UAAM,SAAS,UAAM,uBAAS,OAAO,4BAAwB,kCAAiB,KAAK,IAAI,CAAC;AACxF,YAAQ,IAAI,MAAM;AACrB,WAAO;AAAA,EACN,SAAS,KAAK;AAEZ,UAAM;AAAA,EACR;AACF,GAAG;AAAA;AAAA;AAAA,EAGD,YAAY,EAAE,KAAK,QAAQ,IAAI,WAAW;AAC5C,CAAC;AAEM,MAAM,yBAAyB,IAAI,qBAAO,2BAA2B,OAAO,QAAQ;AACzF,QAAM,EAAE,OAAO,IAAI,IAAI,IAAI;AAE3B,MAAI;AACF,YAAQ,IAAI,8BAA8B,GAAG,aAAa,KAAK,EAAE;AACjE,UAAM,SAAS,UAAM,uBAAS,OAAO,uCAAmC,2CAA0B,GAAG,CAAC;AACtG,YAAQ,IAAI,MAAM;AAClB,WAAO;AAAA,EACT,SAAS,KAAK;AAEZ,UAAM;AAAA,EACR;AACF,GAAG;AAAA,EACD,YAAY,EAAE,KAAK,QAAQ,IAAI,WAAW;AAC5C,CAAC;AAEM,MAAM,0BAA0B,IAAI,qBAAO,4BAA4B,OAAO,QAAQ;AAC3F,QAAM,EAAE,OAAO,UAAU,IAAI,IAAI;AAEjC,MAAI;AACF,YAAQ,IAAI,wCAAwC,KAAK,EAAE;AAC3D,UAAM,SAAS,UAAM,uBAAS,OAAO,uCAAmC,4CAA2B,SAAS,CAAC;AAC7G,YAAQ,IAAI,MAAM;AAClB,WAAO;AAAA,EACT,SAAS,KAAK;AAEZ,UAAM;AAAA,EACR;AACF,GAAG;AAAA,EACD,YAAY,EAAE,KAAK,QAAQ,IAAI,WAAW;AAC5C,CAAC;AAED,UAAU,GAAG,UAAU,CAAC,KAAK,QAAQ;AAErC,CAAC;AAED,uBAAuB,GAAG,UAAU,CAAC,KAAK,QAAQ;AAElD,CAAC;AAED,wBAAwB,GAAG,UAAU,CAAC,KAAK,QAAQ;AAEnD,CAAC;",
  "names": []
}
