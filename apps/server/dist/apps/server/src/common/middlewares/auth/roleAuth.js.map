{
  "version": 3,
  "sources": ["../../../../../../../src/common/middlewares/auth/roleAuth.ts"],
  "sourcesContent": ["import { NextFunction, Request, Response } from \"express\";\r\nimport { errorHandler } from \"../responseHandler\";\r\n\r\n// Role-based authorization middleware\r\n// This should be used AFTER the authUser middleware\r\nexport const requireRole = (allowedRoles: string[] = []) => {\r\n\treturn (req: Request, res: Response, next: NextFunction): void => {\r\n\t\t// Check if user is authenticated first\r\n\t\tif (!req.user) {\r\n\t\t\terrorHandler(res, \"Authentication required\", {}, 401);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// If no roles specified, just check if user is authenticated\r\n\t\tif (allowedRoles.length === 0) {\r\n\t\t\tnext();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check if user has required role (when you add role field to User model)\r\n\t\t// For now, this is a placeholder since the User model doesn't have a role field\r\n\t\t// You can uncomment and modify this when you add roles to your User model\r\n\r\n\t\t/*\r\n\t\tconst userRole = req.user.role || 'user';\r\n\t\tif (!allowedRoles.includes(userRole)) {\r\n\t\t\terrorHandler(res, \"Insufficient permissions\", {}, 403);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// For now, allow all authenticated users\r\n\t\tnext();\r\n\t};\r\n};\r\n\r\n// Convenience middleware for admin-only routes\r\nexport const requireAdmin = requireRole(['admin']);\r\n\r\n// Convenience middleware for verified email users only\r\nexport const requireEmailVerified = (req: Request, res: Response, next: NextFunction): void => {\r\n\tif (!req.user) {\r\n\t\terrorHandler(res, \"Authentication required\", {}, 401);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (!req.user.isEmailVerified) {\r\n\t\terrorHandler(res, \"Email verification required\", {}, 403);\r\n\t\treturn;\r\n\t}\r\n\r\n\tnext();\r\n};"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,6BAA6B;AAItB,MAAM,cAAc,CAAC,eAAyB,CAAC,MAAM;AAC3D,SAAO,CAAC,KAAc,KAAe,SAA6B;AAEjE,QAAI,CAAC,IAAI,MAAM;AACd,+CAAa,KAAK,2BAA2B,CAAC,GAAG,GAAG;AACpD;AAAA,IACD;AAGA,QAAI,aAAa,WAAW,GAAG;AAC9B,WAAK;AACL;AAAA,IACD;AAeA,SAAK;AAAA,EACN;AACD;AAGO,MAAM,eAAe,YAAY,CAAC,OAAO,CAAC;AAG1C,MAAM,uBAAuB,CAAC,KAAc,KAAe,SAA6B;AAC9F,MAAI,CAAC,IAAI,MAAM;AACd,6CAAa,KAAK,2BAA2B,CAAC,GAAG,GAAG;AACpD;AAAA,EACD;AAEA,MAAI,CAAC,IAAI,KAAK,iBAAiB;AAC9B,6CAAa,KAAK,+BAA+B,CAAC,GAAG,GAAG;AACxD;AAAA,EACD;AAEA,OAAK;AACN;",
  "names": []
}
