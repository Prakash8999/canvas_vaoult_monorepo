{
  "version": 3,
  "sources": ["../../../../../../src/common/utils/authLogger.ts"],
  "sourcesContent": ["// Enhanced logging utility for authentication events\r\nexport interface AuthLogData {\r\n\tuserId?: string;\r\n\temail?: string;\r\n\tip?: string;\r\n\tuserAgent?: string;\r\n\turl?: string;\r\n\tmethod?: string;\r\n\ttimestamp?: Date;\r\n\terror?: string;\r\n\taction: 'LOGIN_SUCCESS' | 'LOGIN_FAILED' | 'TOKEN_EXPIRED' | 'TOKEN_INVALID' | 'USER_NOT_FOUND' | 'AUTH_ERROR';\r\n}\r\n\r\nclass AuthLogger {\r\n\tprivate static instance: AuthLogger;\r\n\tprivate logs: AuthLogData[] = [];\r\n\tprivate maxLogs = 1000; // Keep last 1000 logs in memory\r\n\r\n\tprivate constructor() {}\r\n\r\n\tpublic static getInstance(): AuthLogger {\r\n\t\tif (!AuthLogger.instance) {\r\n\t\t\tAuthLogger.instance = new AuthLogger();\r\n\t\t}\r\n\t\treturn AuthLogger.instance;\r\n\t}\r\n\r\n\tpublic log(data: AuthLogData): void {\r\n\t\tconst logEntry: AuthLogData = {\r\n\t\t\t...data,\r\n\t\t\ttimestamp: new Date(),\r\n\t\t};\r\n\r\n\t\t// Add to in-memory logs\r\n\t\tthis.logs.unshift(logEntry);\r\n\t\tif (this.logs.length > this.maxLogs) {\r\n\t\t\tthis.logs.pop();\r\n\t\t}\r\n\r\n\t\t// Console log based on action type\r\n\t\tconst logLevel = this.getLogLevel(data.action);\r\n\t\tconst message = this.formatLogMessage(logEntry);\r\n\r\n\t\tswitch (logLevel) {\r\n\t\t\tcase 'error':\r\n\t\t\t\tconsole.error(message);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'warn':\r\n\t\t\t\tconsole.warn(message);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'info':\r\n\t\t\t\tconsole.info(message);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(message);\r\n\t\t}\r\n\r\n\t\t// TODO: In production, also send critical events to external logging service\r\n\t\tif (this.isCritical(data.action)) {\r\n\t\t    // this.sendToExternalLogger(logEntry);\r\n\t\t    console.error(`[CRITICAL AUTH EVENT] ${message}`);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getLogLevel(action: AuthLogData['action']): 'error' | 'warn' | 'info' | 'debug' {\r\n\t\tswitch (action) {\r\n\t\t\tcase 'LOGIN_FAILED':\r\n\t\t\tcase 'TOKEN_INVALID':\r\n\t\t\tcase 'AUTH_ERROR':\r\n\t\t\t\treturn 'error';\r\n\t\t\tcase 'TOKEN_EXPIRED':\r\n\t\t\tcase 'USER_NOT_FOUND':\r\n\t\t\t\treturn 'warn';\r\n\t\t\tcase 'LOGIN_SUCCESS':\r\n\t\t\t\treturn 'info';\r\n\t\t\tdefault:\r\n\t\t\t\treturn 'debug';\r\n\t\t}\r\n\t}\r\n\r\n\tprivate formatLogMessage(data: AuthLogData): string {\r\n\t\tconst { action, userId, email, ip, url, method, error } = data;\r\n\t\tlet message = `[AUTH] ${action}`;\r\n\t\t\r\n\t\tif (userId) message += ` - User: ${userId}`;\r\n\t\tif (email) message += ` - Email: ${email}`;\r\n\t\tif (ip) message += ` - IP: ${ip}`;\r\n\t\tif (url && method) message += ` - ${method} ${url}`;\r\n\t\tif (error) message += ` - Error: ${error}`;\r\n\r\n\t\treturn message;\r\n\t}\r\n\r\n\tprivate isCritical(action: AuthLogData['action']): boolean {\r\n\t\treturn ['AUTH_ERROR', 'LOGIN_FAILED'].includes(action);\r\n\t}\r\n\r\n\t// Get recent auth logs (useful for debugging)\r\n\tpublic getRecentLogs(count: number = 100): AuthLogData[] {\r\n\t\treturn this.logs.slice(0, count);\r\n\t}\r\n\r\n\t// Get logs for specific user\r\n\tpublic getUserLogs(userId: string, count: number = 50): AuthLogData[] {\r\n\t\treturn this.logs\r\n\t\t\t.filter(log => log.userId === userId)\r\n\t\t\t.slice(0, count);\r\n\t}\r\n\r\n\t// Get failed login attempts from specific IP\r\n\tpublic getFailedAttemptsFromIP(ip: string, timeWindow: number = 15 * 60 * 1000): AuthLogData[] {\r\n\t\tconst cutoff = new Date(Date.now() - timeWindow);\r\n\t\treturn this.logs.filter(log => \r\n\t\t\tlog.ip === ip && \r\n\t\t\tlog.action === 'LOGIN_FAILED' && \r\n\t\t\tlog.timestamp && \r\n\t\t\tlog.timestamp > cutoff\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport const authLogger = AuthLogger.getInstance();"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA,MAAM,WAAW;AAAA,EAChB,OAAe;AAAA,EACP,OAAsB,CAAC;AAAA,EACvB,UAAU;AAAA;AAAA,EAEV,cAAc;AAAA,EAAC;AAAA,EAEvB,OAAc,cAA0B;AACvC,QAAI,CAAC,WAAW,UAAU;AACzB,iBAAW,WAAW,IAAI,WAAW;AAAA,IACtC;AACA,WAAO,WAAW;AAAA,EACnB;AAAA,EAEO,IAAI,MAAyB;AACnC,UAAM,WAAwB;AAAA,MAC7B,GAAG;AAAA,MACH,WAAW,oBAAI,KAAK;AAAA,IACrB;AAGA,SAAK,KAAK,QAAQ,QAAQ;AAC1B,QAAI,KAAK,KAAK,SAAS,KAAK,SAAS;AACpC,WAAK,KAAK,IAAI;AAAA,IACf;AAGA,UAAM,WAAW,KAAK,YAAY,KAAK,MAAM;AAC7C,UAAM,UAAU,KAAK,iBAAiB,QAAQ;AAE9C,YAAQ,UAAU;AAAA,MACjB,KAAK;AACJ,gBAAQ,MAAM,OAAO;AACrB;AAAA,MACD,KAAK;AACJ,gBAAQ,KAAK,OAAO;AACpB;AAAA,MACD,KAAK;AACJ,gBAAQ,KAAK,OAAO;AACpB;AAAA,MACD;AACC,gBAAQ,IAAI,OAAO;AAAA,IACrB;AAGA,QAAI,KAAK,WAAW,KAAK,MAAM,GAAG;AAE9B,cAAQ,MAAM,yBAAyB,OAAO,EAAE;AAAA,IACpD;AAAA,EACD;AAAA,EAEQ,YAAY,QAAoE;AACvF,YAAQ,QAAQ;AAAA,MACf,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AACJ,eAAO;AAAA,MACR,KAAK;AAAA,MACL,KAAK;AACJ,eAAO;AAAA,MACR,KAAK;AACJ,eAAO;AAAA,MACR;AACC,eAAO;AAAA,IACT;AAAA,EACD;AAAA,EAEQ,iBAAiB,MAA2B;AACnD,UAAM,EAAE,QAAQ,QAAQ,OAAO,IAAI,KAAK,QAAQ,MAAM,IAAI;AAC1D,QAAI,UAAU,UAAU,MAAM;AAE9B,QAAI;AAAQ,iBAAW,YAAY,MAAM;AACzC,QAAI;AAAO,iBAAW,aAAa,KAAK;AACxC,QAAI;AAAI,iBAAW,UAAU,EAAE;AAC/B,QAAI,OAAO;AAAQ,iBAAW,MAAM,MAAM,IAAI,GAAG;AACjD,QAAI;AAAO,iBAAW,aAAa,KAAK;AAExC,WAAO;AAAA,EACR;AAAA,EAEQ,WAAW,QAAwC;AAC1D,WAAO,CAAC,cAAc,cAAc,EAAE,SAAS,MAAM;AAAA,EACtD;AAAA;AAAA,EAGO,cAAc,QAAgB,KAAoB;AACxD,WAAO,KAAK,KAAK,MAAM,GAAG,KAAK;AAAA,EAChC;AAAA;AAAA,EAGO,YAAY,QAAgB,QAAgB,IAAmB;AACrE,WAAO,KAAK,KACV,OAAO,SAAO,IAAI,WAAW,MAAM,EACnC,MAAM,GAAG,KAAK;AAAA,EACjB;AAAA;AAAA,EAGO,wBAAwB,IAAY,aAAqB,KAAK,KAAK,KAAqB;AAC9F,UAAM,SAAS,IAAI,KAAK,KAAK,IAAI,IAAI,UAAU;AAC/C,WAAO,KAAK,KAAK;AAAA,MAAO,SACvB,IAAI,OAAO,MACX,IAAI,WAAW,kBACf,IAAI,aACJ,IAAI,YAAY;AAAA,IACjB;AAAA,EACD;AACD;AAEO,MAAM,aAAa,WAAW,YAAY;",
  "names": []
}
