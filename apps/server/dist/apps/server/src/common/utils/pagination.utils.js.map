{
  "version": 3,
  "sources": ["../../../../../../src/common/utils/pagination.utils.ts"],
  "sourcesContent": ["import { Model, FindAndCountOptions, Includeable, Order } from \"sequelize\";\r\n\r\ninterface PaginationMeta {\r\n    total_count: number;\r\n    total_pages: number;\r\n    limit: number;\r\n    offset: number;\r\n    page: number;\r\n}\r\n\r\ninterface PaginatedResult<T> {\r\n    data: T[];\r\n    meta: PaginationMeta;\r\n}\r\n\r\nexport const paginateAndSort = async <T extends Model>(\r\n    model: (new () => T) & { findAndCountAll: (options: FindAndCountOptions) => Promise<{ count: number; rows: T[] }> },\r\n    filters: Record<string, any> = {},\r\n    page: number = 1,\r\n    limit: number = 50,\r\n    order: Order = [[\"name\", \"ASC\"]],\r\n    include: Includeable[] = [],\r\n    attributes?: string[],\r\n    excludeAttributes?: string[],\r\n): Promise<PaginatedResult<T>> => {\r\n    delete filters?.order;\r\n    const offset = (page - 1) * limit;\r\n\r\n    // Handle excludeAttributes\r\n    let finalAttributes = attributes;\r\n    if (excludeAttributes && excludeAttributes.length > 0) {\r\n        const allAttributes = Object.keys((model as any).rawAttributes || {});\r\n        finalAttributes = allAttributes.filter(attr => !excludeAttributes.includes(attr));\r\n    }\r\n\r\n    const params: FindAndCountOptions = {\r\n        where: filters,\r\n        limit: limit,\r\n        offset: offset,\r\n        include: include,\r\n        distinct: true,\r\n        attributes: finalAttributes\r\n    };\r\n\r\n    if (Array.isArray(order) && order.length > 0) {\r\n        params.order = order;\r\n    }\r\n\r\n    const { count, rows } = await model.findAndCountAll(params);\r\n    const totalPages = Math.ceil(count / limit);\r\n\r\n    return {\r\n        data: rows.map((record) => record.toJSON()),\r\n        meta: {\r\n            total_count: count,\r\n            total_pages: totalPages,\r\n            limit: limit,\r\n            offset: offset,\r\n            page: page,\r\n        },\r\n    };\r\n};"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAeO,MAAM,kBAAkB,OAC3B,OACA,UAA+B,CAAC,GAChC,OAAe,GACf,QAAgB,IAChB,QAAe,CAAC,CAAC,QAAQ,KAAK,CAAC,GAC/B,UAAyB,CAAC,GAC1B,YACA,sBAC8B;AAC9B,SAAO,SAAS;AAChB,QAAM,UAAU,OAAO,KAAK;AAG5B,MAAI,kBAAkB;AACtB,MAAI,qBAAqB,kBAAkB,SAAS,GAAG;AACnD,UAAM,gBAAgB,OAAO,KAAM,MAAc,iBAAiB,CAAC,CAAC;AACpE,sBAAkB,cAAc,OAAO,UAAQ,CAAC,kBAAkB,SAAS,IAAI,CAAC;AAAA,EACpF;AAEA,QAAM,SAA8B;AAAA,IAChC,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA,UAAU;AAAA,IACV,YAAY;AAAA,EAChB;AAEA,MAAI,MAAM,QAAQ,KAAK,KAAK,MAAM,SAAS,GAAG;AAC1C,WAAO,QAAQ;AAAA,EACnB;AAEA,QAAM,EAAE,OAAO,KAAK,IAAI,MAAM,MAAM,gBAAgB,MAAM;AAC1D,QAAM,aAAa,KAAK,KAAK,QAAQ,KAAK;AAE1C,SAAO;AAAA,IACH,MAAM,KAAK,IAAI,CAAC,WAAW,OAAO,OAAO,CAAC;AAAA,IAC1C,MAAM;AAAA,MACF,aAAa;AAAA,MACb,aAAa;AAAA,MACb;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AACJ;",
  "names": []
}
