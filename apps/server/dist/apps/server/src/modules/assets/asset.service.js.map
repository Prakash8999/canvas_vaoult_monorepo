{
  "version": 3,
  "sources": ["../../../../../../src/modules/assets/asset.service.ts"],
  "sourcesContent": ["import { DeleteObjectCommand, S3Client } from \"@aws-sdk/client-s3\";\r\nimport { s3Client } from \"../../common/libs/s3/s3-client\";\r\n\r\nexport interface UploadedFile {\r\n  size: number;\r\n  url: string;\r\n  key: string;\r\n}\r\n\r\nexport interface DeleteFilesResult {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\nexport class AssetService {\r\n  private s3Client: S3Client;\r\n\r\n  constructor() {\r\n    this.s3Client = s3Client;\r\n  }\r\n\r\n  /**\r\n   * Delete multiple files from S3\r\n   */\r\n  async deleteMultipleFiles(keys: string[]): Promise<DeleteFilesResult> {\r\n    try {\r\n      const deletePromises = keys.map(async (key) => {\r\n        const command = new DeleteObjectCommand({\r\n          Bucket: process.env.S3_BUCKET!,\r\n          Key: key,\r\n        });\r\n\r\n        const response = await this.s3Client.send(command);\r\n\r\n        if (response.$metadata.httpStatusCode !== 204) {\r\n          throw new Error(`Failed to delete file: ${key}`);\r\n        }\r\n      });\r\n\r\n      await Promise.all(deletePromises);\r\n\r\n      return { success: true, message: \"All files deleted successfully\" };\r\n    } catch (error) {\r\n      console.error(\"Error deleting multiple files:\", error);\r\n      throw new Error(\"Failed to delete one or more files from S3\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process uploaded files and return formatted response\r\n   */\r\n  processUploadedFiles(files: Express.Multer.File[]): UploadedFile[] {\r\n    if (!files || files.length === 0) {\r\n      throw new Error(\"No files uploaded\");\r\n    }\r\n\r\n    return files.map((file: any) => ({\r\n      size: +(file.size / 1024).toFixed(2), // Size in KB\r\n      url: file.location,\r\n      key: file.key,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Process single uploaded file and return formatted response\r\n   */\r\n  processUploadedFile(file: Express.Multer.File): UploadedFile {\r\n    if (!file) {\r\n      throw new Error(\"No file uploaded\");\r\n    }\r\n\r\n    return {\r\n      size: +(file.size / 1024).toFixed(2), // Size in KB\r\n      url: (file as any).location,\r\n      key: (file as any).key,\r\n    };\r\n  }\r\n}\r\n\r\nexport const assetService = new AssetService();"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAA8C;AAC9C,uBAAyB;AAalB,MAAM,aAAa;AAAA,EAChB;AAAA,EAER,cAAc;AACZ,SAAK,WAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAoB,MAA4C;AACpE,QAAI;AACF,YAAM,iBAAiB,KAAK,IAAI,OAAO,QAAQ;AAC7C,cAAM,UAAU,IAAI,qCAAoB;AAAA,UACtC,QAAQ,QAAQ,IAAI;AAAA,UACpB,KAAK;AAAA,QACP,CAAC;AAED,cAAM,WAAW,MAAM,KAAK,SAAS,KAAK,OAAO;AAEjD,YAAI,SAAS,UAAU,mBAAmB,KAAK;AAC7C,gBAAM,IAAI,MAAM,0BAA0B,GAAG,EAAE;AAAA,QACjD;AAAA,MACF,CAAC;AAED,YAAM,QAAQ,IAAI,cAAc;AAEhC,aAAO,EAAE,SAAS,MAAM,SAAS,iCAAiC;AAAA,IACpE,SAAS,OAAO;AACd,cAAQ,MAAM,kCAAkC,KAAK;AACrD,YAAM,IAAI,MAAM,4CAA4C;AAAA,IAC9D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,OAA8C;AACjE,QAAI,CAAC,SAAS,MAAM,WAAW,GAAG;AAChC,YAAM,IAAI,MAAM,mBAAmB;AAAA,IACrC;AAEA,WAAO,MAAM,IAAI,CAAC,UAAe;AAAA,MAC/B,MAAM,EAAE,KAAK,OAAO,MAAM,QAAQ,CAAC;AAAA;AAAA,MACnC,KAAK,KAAK;AAAA,MACV,KAAK,KAAK;AAAA,IACZ,EAAE;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,MAAyC;AAC3D,QAAI,CAAC,MAAM;AACT,YAAM,IAAI,MAAM,kBAAkB;AAAA,IACpC;AAEA,WAAO;AAAA,MACL,MAAM,EAAE,KAAK,OAAO,MAAM,QAAQ,CAAC;AAAA;AAAA,MACnC,KAAM,KAAa;AAAA,MACnB,KAAM,KAAa;AAAA,IACrB;AAAA,EACF;AACF;AAEO,MAAM,eAAe,IAAI,aAAa;",
  "names": []
}
