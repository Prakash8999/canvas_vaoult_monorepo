{
  "version": 3,
  "sources": ["../../../../../../src/modules/ai/ai.controller.ts"],
  "sourcesContent": ["import { Request, Response } from 'express';\r\nimport { AIService } from './services/ai.service';\r\nimport { successHandler, errorHandler } from '../../common/middlewares/responseHandler';\r\nimport { parseError } from '../../common/utils/error.parser';\r\nimport {\r\n    AIProviderError,\r\n    InsufficientCreditsError,\r\n    InvalidInputError,\r\n} from './ai.types';\r\n\r\n/**\r\n * AI Controller\r\n * Handles HTTP requests for AI operations\r\n * Controllers should be thin - business logic lives in services\r\n */\r\n\r\n/**\r\n * Execute AI request\r\n * POST /api/ai/generate\r\n */\r\nexport const generateAIResponse = async (req: Request, res: Response) => {\r\n    try {\r\n        // Authenticate user\r\n        if (!req.user || !req.user.userId) {\r\n            return errorHandler(res, 'Unauthorized', {}, 401);\r\n        }\r\n\r\n        const userId = req.user.userId;\r\n\r\n        // Execute AI request (key resolution handles internally)\r\n        const response = await AIService.executeRequest(userId, req.body);\r\n\r\n        return successHandler(\r\n            res,\r\n            'AI response generated successfully',\r\n            response,\r\n            200\r\n        );\r\n    } catch (error) {\r\n        console.error('Error generating AI response:', error);\r\n\r\n        // Handle specific error types\r\n        if (error instanceof InsufficientCreditsError) {\r\n            return errorHandler(\r\n                res,\r\n                'Insufficient AI credits',\r\n                {\r\n                    required: error.required,\r\n                    available: error.available,\r\n                },\r\n                402 // Payment Required\r\n            );\r\n        }\r\n\r\n        if (error instanceof InvalidInputError) {\r\n            return errorHandler(res, error.message, {}, 400);\r\n        }\r\n\r\n        if (error instanceof AIProviderError) {\r\n            return errorHandler(\r\n                res,\r\n                error.message,\r\n                { provider: error.provider },\r\n                error.statusCode\r\n            );\r\n        }\r\n\r\n        // Generic error handling\r\n        const errorParser = parseError(error);\r\n        return errorHandler(\r\n            res,\r\n            'Failed to generate AI response',\r\n            errorParser.message,\r\n            errorParser.statusCode\r\n        );\r\n    }\r\n};\r\n\r\n/**\r\n * Get user's remaining AI credits\r\n * GET /api/ai/credits\r\n */\r\nexport const getCredits = async (req: Request, res: Response) => {\r\n    try {\r\n        if (!req.user || !req.user.userId) {\r\n            return errorHandler(res, 'Unauthorized', {}, 401);\r\n        }\r\n\r\n        const userId = req.user.userId;\r\n        const credits = await AIService.getRemainingCredits(userId);\r\n\r\n        return successHandler(\r\n            res,\r\n            'Credits fetched successfully',\r\n            { credits },\r\n            200\r\n        );\r\n    } catch (error) {\r\n        console.error('Error fetching credits:', error);\r\n        const errorParser = parseError(error);\r\n        return errorHandler(\r\n            res,\r\n            'Failed to fetch credits',\r\n            errorParser.message,\r\n            errorParser.statusCode\r\n        );\r\n    }\r\n};\r\n\r\n/**\r\n * Get AI constraints and supported providers\r\n * GET /api/ai/constraints\r\n */\r\nexport const getConstraints = async (req: Request, res: Response) => {\r\n    try {\r\n        const constraints = AIService.getConstraints();\r\n\r\n        return successHandler(\r\n            res,\r\n            'Constraints fetched successfully',\r\n            constraints,\r\n            200\r\n        );\r\n    } catch (error) {\r\n        console.error('Error fetching constraints:', error);\r\n        const errorParser = parseError(error);\r\n        return errorHandler(\r\n            res,\r\n            'Failed to fetch constraints',\r\n            errorParser.message,\r\n            errorParser.statusCode\r\n        );\r\n    }\r\n};\r\n\r\n\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,gBAA0B;AAC1B,6BAA6C;AAC7C,mBAA2B;AAC3B,IAAAA,aAIO;AAYA,MAAM,qBAAqB,OAAO,KAAc,QAAkB;AACrE,MAAI;AAEA,QAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,QAAQ;AAC/B,iBAAO,qCAAa,KAAK,gBAAgB,CAAC,GAAG,GAAG;AAAA,IACpD;AAEA,UAAM,SAAS,IAAI,KAAK;AAGxB,UAAM,WAAW,MAAM,oBAAU,eAAe,QAAQ,IAAI,IAAI;AAEhE,eAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ,SAAS,OAAO;AACZ,YAAQ,MAAM,iCAAiC,KAAK;AAGpD,QAAI,iBAAiB,qCAA0B;AAC3C,iBAAO;AAAA,QACH;AAAA,QACA;AAAA,QACA;AAAA,UACI,UAAU,MAAM;AAAA,UAChB,WAAW,MAAM;AAAA,QACrB;AAAA,QACA;AAAA;AAAA,MACJ;AAAA,IACJ;AAEA,QAAI,iBAAiB,8BAAmB;AACpC,iBAAO,qCAAa,KAAK,MAAM,SAAS,CAAC,GAAG,GAAG;AAAA,IACnD;AAEA,QAAI,iBAAiB,4BAAiB;AAClC,iBAAO;AAAA,QACH;AAAA,QACA,MAAM;AAAA,QACN,EAAE,UAAU,MAAM,SAAS;AAAA,QAC3B,MAAM;AAAA,MACV;AAAA,IACJ;AAGA,UAAM,kBAAc,yBAAW,KAAK;AACpC,eAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ,YAAY;AAAA,IAChB;AAAA,EACJ;AACJ;AAMO,MAAM,aAAa,OAAO,KAAc,QAAkB;AAC7D,MAAI;AACA,QAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,QAAQ;AAC/B,iBAAO,qCAAa,KAAK,gBAAgB,CAAC,GAAG,GAAG;AAAA,IACpD;AAEA,UAAM,SAAS,IAAI,KAAK;AACxB,UAAM,UAAU,MAAM,oBAAU,oBAAoB,MAAM;AAE1D,eAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA,EAAE,QAAQ;AAAA,MACV;AAAA,IACJ;AAAA,EACJ,SAAS,OAAO;AACZ,YAAQ,MAAM,2BAA2B,KAAK;AAC9C,UAAM,kBAAc,yBAAW,KAAK;AACpC,eAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ,YAAY;AAAA,IAChB;AAAA,EACJ;AACJ;AAMO,MAAM,iBAAiB,OAAO,KAAc,QAAkB;AACjE,MAAI;AACA,UAAM,cAAc,oBAAU,eAAe;AAE7C,eAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ,SAAS,OAAO;AACZ,YAAQ,MAAM,+BAA+B,KAAK;AAClD,UAAM,kBAAc,yBAAW,KAAK;AACpC,eAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ,YAAY;AAAA,IAChB;AAAA,EACJ;AACJ;",
  "names": ["import_ai"]
}
