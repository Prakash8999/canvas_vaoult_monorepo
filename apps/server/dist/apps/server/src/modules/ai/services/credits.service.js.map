{
  "version": 3,
  "sources": ["../../../../../../../src/modules/ai/services/credits.service.ts"],
  "sourcesContent": ["import User from '../../users/users.model';\r\nimport { InsufficientCreditsError } from '../ai.types';\r\n\r\n/**\r\n * AI Credits Service\r\n * Handles all credit-related operations\r\n * Separated from AI execution logic for modularity\r\n */\r\nexport class AICreditsService {\r\n    /**\r\n     * Get user's current AI credits\r\n     * @param userId - User ID\r\n     * @returns Current credit balance\r\n     */\r\n    static async getUserCredits(userId: number): Promise<number> {\r\n        const user = await User.findByPk(userId, {\r\n            attributes: ['ai_credits'],\r\n        });\r\n\r\n        if (!user) {\r\n            throw new Error('User not found');\r\n        }\r\n\r\n        return user.ai_credits;\r\n    }\r\n\r\n    /**\r\n     * Check if user has sufficient credits\r\n     * @param userId - User ID\r\n     * @param required - Required credits\r\n     * @returns True if user has enough credits\r\n     */\r\n    static async hasCredits(userId: number, required: number = 1): Promise<boolean> {\r\n        const available = await this.getUserCredits(userId);\r\n        return available >= required;\r\n    }\r\n\r\n    /**\r\n     * Deduct credits from user account\r\n     * Only deducts if user has sufficient credits\r\n     * @param userId - User ID\r\n     * @param amount - Amount to deduct\r\n     * @returns New credit balance\r\n     * @throws InsufficientCreditsError if user doesn't have enough credits\r\n     */\r\n    static async deductCredits(userId: number, amount: number = 1): Promise<number> {\r\n        const user = await User.findByPk(userId);\r\n\r\n        if (!user) {\r\n            throw new Error('User not found');\r\n        }\r\n\r\n        // Check if user has enough credits\r\n        if (user.ai_credits < amount) {\r\n            throw new InsufficientCreditsError(amount, user.ai_credits);\r\n        }\r\n\r\n        // Deduct credits\r\n        user.ai_credits -= amount;\r\n        await user.save();\r\n\r\n        return user.ai_credits;\r\n    }\r\n\r\n    /**\r\n     * Add credits to user account\r\n     * @param userId - User ID\r\n     * @param amount - Amount to add\r\n     * @returns New credit balance\r\n     */\r\n    static async addCredits(userId: number, amount: number): Promise<number> {\r\n        const user = await User.findByPk(userId);\r\n\r\n        if (!user) {\r\n            throw new Error('User not found');\r\n        }\r\n\r\n        user.ai_credits += amount;\r\n        await user.save();\r\n\r\n        return user.ai_credits;\r\n    }\r\n\r\n    /**\r\n     * Reset user credits to default value\r\n     * @param userId - User ID\r\n     * @param defaultAmount - Default credit amount\r\n     * @returns New credit balance\r\n     */\r\n    static async resetCredits(userId: number, defaultAmount: number = 10): Promise<number> {\r\n        const user = await User.findByPk(userId);\r\n\r\n        if (!user) {\r\n            throw new Error('User not found');\r\n        }\r\n\r\n        user.ai_credits = defaultAmount;\r\n        await user.save();\r\n\r\n        return user.ai_credits;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAiB;AACjB,gBAAyC;AAOlC,MAAM,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM1B,aAAa,eAAe,QAAiC;AACzD,UAAM,OAAO,MAAM,aAAAA,QAAK,SAAS,QAAQ;AAAA,MACrC,YAAY,CAAC,YAAY;AAAA,IAC7B,CAAC;AAED,QAAI,CAAC,MAAM;AACP,YAAM,IAAI,MAAM,gBAAgB;AAAA,IACpC;AAEA,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAa,WAAW,QAAgB,WAAmB,GAAqB;AAC5E,UAAM,YAAY,MAAM,KAAK,eAAe,MAAM;AAClD,WAAO,aAAa;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,aAAa,cAAc,QAAgB,SAAiB,GAAoB;AAC5E,UAAM,OAAO,MAAM,aAAAA,QAAK,SAAS,MAAM;AAEvC,QAAI,CAAC,MAAM;AACP,YAAM,IAAI,MAAM,gBAAgB;AAAA,IACpC;AAGA,QAAI,KAAK,aAAa,QAAQ;AAC1B,YAAM,IAAI,mCAAyB,QAAQ,KAAK,UAAU;AAAA,IAC9D;AAGA,SAAK,cAAc;AACnB,UAAM,KAAK,KAAK;AAEhB,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAa,WAAW,QAAgB,QAAiC;AACrE,UAAM,OAAO,MAAM,aAAAA,QAAK,SAAS,MAAM;AAEvC,QAAI,CAAC,MAAM;AACP,YAAM,IAAI,MAAM,gBAAgB;AAAA,IACpC;AAEA,SAAK,cAAc;AACnB,UAAM,KAAK,KAAK;AAEhB,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAa,aAAa,QAAgB,gBAAwB,IAAqB;AACnF,UAAM,OAAO,MAAM,aAAAA,QAAK,SAAS,MAAM;AAEvC,QAAI,CAAC,MAAM;AACP,YAAM,IAAI,MAAM,gBAAgB;AAAA,IACpC;AAEA,SAAK,aAAa;AAClB,UAAM,KAAK,KAAK;AAEhB,WAAO,KAAK;AAAA,EAChB;AACJ;",
  "names": ["User"]
}
