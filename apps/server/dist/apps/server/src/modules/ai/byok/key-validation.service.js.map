{
  "version": 3,
  "sources": ["../../../../../../../src/modules/ai/byok/key-validation.service.ts"],
  "sourcesContent": ["import axios from 'axios';\r\n\r\nexport class ApiKeyValidationService {\r\n    /**\r\n     * Validates an API key for a specific provider without consuming significant resources.\r\n     */\r\n    static async validate(provider: string, apiKey: string): Promise<boolean> {\r\n        try {\r\n            switch (provider) {\r\n                case 'gemini':\r\n                    return await this.validateGemini(apiKey);\r\n                case 'perplexity':\r\n                    return await this.validatePerplexity(apiKey);\r\n                default:\r\n                    // Unknown provider, fail safe\r\n                    return false;\r\n            }\r\n        } catch (error: any) {\r\n            // Log full error for debugging but return false\r\n            console.warn(`[ApiKeyValidation] Validation failed for ${provider}:`, error.message);\r\n            if (error.response) {\r\n                console.warn(`[ApiKeyValidation] Response: ${error.response.status} - ${JSON.stringify(error.response.data)}`);\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private static async validateGemini(apiKey: string): Promise<boolean> {\r\n        // Use the 'list models' endpoint which validates the key and is lightweight\r\n        const url = `https://generativelanguage.googleapis.com/v1beta/models?page_size=1&key=${apiKey}`;\r\n        const response = await axios.get(url);\r\n        return response.status === 200;\r\n    }\r\n\r\n    private static async validatePerplexity(apiKey: string): Promise<boolean> {\r\n        // Perplexity doesn't expose a dedicated validation endpoint,\r\n        // so we perform a minimal completion request with max_tokens=1\r\n        const response = await axios.post(\r\n            'https://api.perplexity.ai/chat/completions',\r\n            {\r\n                model: 'sonar',\r\n                messages: [{ role: 'user', content: 'Hi' }],\r\n                max_tokens: 1,\r\n            },\r\n            {\r\n                headers: {\r\n                    'Authorization': `Bearer ${apiKey}`,\r\n                    'Content-Type': 'application/json',\r\n                },\r\n            }\r\n        );\r\n        return response.status === 200;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAEX,MAAM,wBAAwB;AAAA;AAAA;AAAA;AAAA,EAIjC,aAAa,SAAS,UAAkB,QAAkC;AACtE,QAAI;AACA,cAAQ,UAAU;AAAA,QACd,KAAK;AACD,iBAAO,MAAM,KAAK,eAAe,MAAM;AAAA,QAC3C,KAAK;AACD,iBAAO,MAAM,KAAK,mBAAmB,MAAM;AAAA,QAC/C;AAEI,iBAAO;AAAA,MACf;AAAA,IACJ,SAAS,OAAY;AAEjB,cAAQ,KAAK,4CAA4C,QAAQ,KAAK,MAAM,OAAO;AACnF,UAAI,MAAM,UAAU;AAChB,gBAAQ,KAAK,gCAAgC,MAAM,SAAS,MAAM,MAAM,KAAK,UAAU,MAAM,SAAS,IAAI,CAAC,EAAE;AAAA,MACjH;AACA,aAAO;AAAA,IACX;AAAA,EACJ;AAAA,EAEA,aAAqB,eAAe,QAAkC;AAElE,UAAM,MAAM,2EAA2E,MAAM;AAC7F,UAAM,WAAW,MAAM,aAAAA,QAAM,IAAI,GAAG;AACpC,WAAO,SAAS,WAAW;AAAA,EAC/B;AAAA,EAEA,aAAqB,mBAAmB,QAAkC;AAGtE,UAAM,WAAW,MAAM,aAAAA,QAAM;AAAA,MACzB;AAAA,MACA;AAAA,QACI,OAAO;AAAA,QACP,UAAU,CAAC,EAAE,MAAM,QAAQ,SAAS,KAAK,CAAC;AAAA,QAC1C,YAAY;AAAA,MAChB;AAAA,MACA;AAAA,QACI,SAAS;AAAA,UACL,iBAAiB,UAAU,MAAM;AAAA,UACjC,gBAAgB;AAAA,QACpB;AAAA,MACJ;AAAA,IACJ;AACA,WAAO,SAAS,WAAW;AAAA,EAC/B;AACJ;",
  "names": ["axios"]
}
