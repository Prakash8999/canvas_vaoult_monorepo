{
  "version": 3,
  "sources": ["../../../../../../src/modules/canvas/canvas.controller.ts"],
  "sourcesContent": ["import { Request, Response } from \"express\";\r\nimport { errorHandler, successHandler } from \"../../common/middlewares/responseHandler\";\r\nimport { parseError } from \"../../common/utils/error.parser\";\r\nimport * as canvasService from \"./canvas.service\";\r\nimport { CanvasQueryAttributes } from \"./canvas.model\";\r\n\r\n// CRUD Operations\r\n\r\nexport const createCanvas = async (req: Request, res: Response) => {\r\n    try {\r\n        if (!req.user || !req.user.userId) {\r\n            errorHandler(res, \"Unauthorized\", {}, 401);\r\n            return;\r\n        }\r\n        const userId = req.user.userId;\r\n        const canvas = await canvasService.createCanvasService(req.body, userId);\r\n        successHandler(res, \"Canvas created successfully\", canvas, 201);\r\n    } catch (error) {\r\n        console.error(\"Error creating canvas:\", error);\r\n        const errorParser = parseError(error);\r\n        errorHandler(res, \"Failed to create canvas\", errorParser.message, errorParser.statusCode);\r\n    }\r\n};\r\n\r\nexport const getAllCanvases = async (req: Request, res: Response) => {\r\n    try {\r\n        const userId = req.user.userId;\r\n\r\n        // Query params are already validated and typed by validateQuery middleware\r\n        const filters: CanvasQueryAttributes = {\r\n            ...req.query,\r\n        };\r\n\r\n        const result = await canvasService.getAllCanvasesService(userId, filters);\r\n\r\n        const responseData = {\r\n            canvases: result.data,\r\n            pagination: {\r\n                total: result.meta.total_count,\r\n                page: result.meta.page,\r\n                limit: result.meta.limit,\r\n                totalPages: result.meta.total_pages,\r\n                hasMore: result.meta.page < result.meta.total_pages,\r\n            }\r\n        };\r\n\r\n        return successHandler(res, \"Canvases fetched successfully\", responseData, 200);\r\n    } catch (error) {\r\n        console.log(\"Error fetching canvases:\", error);\r\n        const errorParser = parseError(error);\r\n        return errorHandler(res, \"Failed to fetch canvases\", errorParser.message, errorParser.statusCode);\r\n    }\r\n};\r\n\r\nexport const getCanvas = async (req: Request, res: Response) => {\r\n    try {\r\n        const userId = req.user.userId;\r\n        // Params are already validated by validateParams middleware\r\n        const { uid } = req.params;\r\n        console.log('Fetching canvas with uid:', uid, 'for userId:', userId);\r\n\r\n        const canvas = await canvasService.getCanvasByUidService(uid, userId);\r\n\r\n        if (!canvas) {\r\n            return errorHandler(res, \"Canvas not found\", {}, 404);\r\n        }\r\n        // console.log('Canvas fetched successfully:', canvas);\r\n        return successHandler(res, \"Canvas fetched successfully\", {\r\n            id: canvas.id,\r\n            canvas_uid: canvas.canvas_uid,\r\n            title: canvas.title,\r\n            userId: canvas.user_id,\r\n            note_id: canvas.note_id,\r\n            canvas_data: canvas.canvas_data,\r\n            document_data: canvas.document_data,\r\n            viewport: canvas.viewport,\r\n            pinned: canvas.pinned,\r\n            created_at: canvas.created_at,\r\n            updated_at: canvas.updated_at,\r\n            note: canvas.note || null,\r\n        }, 200);\r\n    } catch (error) {\r\n        const errorParser = parseError(error);\r\n        return errorHandler(res, \"Failed to fetch canvas\", errorParser.message, errorParser.statusCode);\r\n    }\r\n};\r\n\r\nexport const updateCanvas = async (req: Request, res: Response) => {\r\n    try {\r\n        const userId = req.user.userId;\r\n        // Params are already validated and coerced to number by validateParams middleware\r\n        const { id } = req.params;\r\n\r\n        console.log(\"Updating canvas body:\", req.body);\r\n        const canvas = await canvasService.updateCanvasService(Number(id), req.body, userId);\r\n\r\n        if (!canvas) {\r\n            return errorHandler(res, \"Canvas not found\", {}, 404);\r\n        }\r\n\r\n        return successHandler(res, \"Canvas updated successfully\", {\r\n            // id: canvas.id,\r\n            // canvas_uid: canvas.canvas_uid,\r\n            // title: canvas.title,\r\n            // note_id: canvas.note_id,\r\n            // canvas_data: canvas.canvas_data,\r\n            // document_data: canvas.document_data,\r\n            // viewport: canvas.viewport,\r\n            // pinned: canvas.pinned,\r\n            // created_at: canvas.created_at,\r\n            // updated_at: canvas.updated_at,\r\n            // note: canvas.note || null,\r\n        }, 200);\r\n    } catch (error) {\r\n        console.error(\"Error updating canvas:\", error);\r\n        const errorParser = parseError(error);\r\n        return errorHandler(res, \"Failed to update canvas\", errorParser.message, errorParser.statusCode);\r\n    }\r\n};\r\n\r\nexport const deleteCanvas = async (req: Request, res: Response) => {\r\n    try {\r\n        const userId = req.user.userId;\r\n        // Params are already validated and coerced to number by validateParams middleware\r\n        const { id } = req.params;\r\n\r\n        const deleted = await canvasService.deleteCanvasService(Number(id), userId);\r\n\r\n        if (!deleted) {\r\n            return errorHandler(res, \"Canvas not found\", {}, 404);\r\n        }\r\n\r\n        return successHandler(res, \"Canvas deleted successfully\", { deletedId: Number(id) }, 200);\r\n    } catch (error) {\r\n        const errorParser = parseError(error);\r\n        return errorHandler(res, \"Failed to delete canvas\", errorParser.message, errorParser.statusCode);\r\n    }\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
