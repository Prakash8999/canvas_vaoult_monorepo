{
  "version": 3,
  "sources": ["../../../../../../src/modules/canvas/canvas.model.ts"],
  "sourcesContent": ["import { DataTypes, Model } from 'sequelize';\r\nimport sequelize from '../../config/database';\r\nimport { z } from 'zod';\r\nimport { extendZodWithOpenApi } from '@asteasolutions/zod-to-openapi';\r\nimport Note from '../notes/notes.model';\r\n\r\nextendZodWithOpenApi(z);\r\n\r\nexport const CanvasSchema = z\r\n    .object({\r\n        id: z.number().int().openapi({\r\n            example: 1,\r\n            description: 'Unique identifier for the canvas',\r\n        }),\r\n        canvas_uid: z.string().openapi({\r\n            example: 'canvas-12345',\r\n            description: 'Unique UID for the canvas, used for client-side identification',\r\n        }),\r\n        user_id: z.number().int().openapi({\r\n            example: 1,\r\n            description: 'ID of the user who owns the canvas',\r\n        }),\r\n        note_id: z.number().int().optional().nullable().openapi({\r\n            example: 1,\r\n            description: 'ID of the associated note (One-to-One relationship)',\r\n        }),\r\n        title: z.string().min(1).openapi({\r\n            example: 'My Canvas',\r\n            description: 'Name of the canvas',\r\n        }),\r\n        canvas_data: z.any().optional().openapi({\r\n            description: 'Excalidraw canvas elements data'\r\n        }),\r\n        document_data: z\r\n            .record(z.string(), z.any()).optional()\r\n            .openapi({\r\n                description: 'EditorJS document data associated with the canvas'\r\n            }),\r\n        viewport: z.object({\r\n            scrollX: z.number().optional(),\r\n            scrollY: z.number().optional(),\r\n            zoom: z.number().optional(),\r\n        }).optional().nullable().openapi({\r\n            description: 'Viewport state (scroll, zoom)'\r\n        }),\r\n        pinned: z.boolean().default(false).openapi({\r\n            example: false,\r\n            description: 'Whether the canvas is pinned',\r\n        }),\r\n        created_at: z.date().optional().openapi({\r\n            type: 'string',\r\n            format: 'date-time',\r\n            description: 'Timestamp when the canvas was created',\r\n        }),\r\n        updated_at: z.date().optional().openapi({\r\n            type: 'string',\r\n            format: 'date-time',\r\n            description: 'Timestamp when the canvas was last updated',\r\n        }),\r\n    })\r\n    .openapi({\r\n        title: 'Canvas',\r\n        description: 'Represents a canvas entity',\r\n    });\r\n\r\n// --------------------\r\n// \uD83E\uDDE9 Derived Schemas\r\n// --------------------\r\nexport const CreateCanvasSchema = CanvasSchema.omit({\r\n    id: true,\r\n    created_at: true,\r\n    updated_at: true,\r\n    user_id: true,\r\n    canvas_uid: true,\r\n}).openapi({\r\n    title: 'CreateCanvasInput',\r\n    description: 'Payload for creating a new canvas',\r\n});\r\n\r\nexport const UpdateCanvasSchema = CanvasSchema.partial().omit({\r\n    id: true,\r\n    user_id: true,\r\n    updated_at: true,\r\n    canvas_uid: true,\r\n    created_at: true,\r\n}).openapi({\r\n    title: 'UpdateCanvasInput',\r\n    description: 'Payload for updating an existing canvas',\r\n});\r\n\r\nexport const GetCanvasQuerySchema = z.object({\r\n    // Reuse fields from CanvasSchema with query-specific transformations\r\n    id: CanvasSchema.shape.id.optional(),\r\n    canvas_uid: CanvasSchema.shape.canvas_uid.optional(),\r\n    note_id: z.coerce.number().int().positive().optional().openapi({\r\n        example: 1,\r\n        description: 'Filter by associated note ID',\r\n    }),\r\n    title: CanvasSchema.shape.title.optional(),\r\n    pinned: z.enum(['true', 'false']).transform(val => val === 'true').optional().openapi({\r\n        example: 'true',\r\n        description: 'Filter by pinned status (true/false)',\r\n    }),\r\n    search: z.string().optional().openapi({\r\n        example: 'canvas',\r\n        description: 'Search across canvas titles (partial match)',\r\n    }),\r\n    page: z.coerce.number().int().positive().default(1).optional().openapi({\r\n        example: 1,\r\n        description: 'Page number for pagination',\r\n    }),\r\n    limit: z.coerce.number().int().positive().max(100).default(10).optional().openapi({\r\n        example: 10,\r\n        description: 'Number of items per page (max 100)',\r\n    }),\r\n    sort: z.enum(['asc', 'desc']).optional().openapi({\r\n        example: 'asc',\r\n        description: 'Sort order (asc/desc)',\r\n    }),\r\n    sort_by: z.enum(['created_at', 'updated_at']).optional().openapi({\r\n        example: 'created_at',\r\n        description: 'Sort by (created_at/updated_at)',\r\n    }),\r\n    created_at: z.date().optional().openapi({\r\n        example: '2022-01-01T00:00:00.000Z',\r\n        description: 'Filter by created_at date',\r\n    }),\r\n    updated_at: z.date().optional().openapi({\r\n        example: '2022-01-01T00:00:00.000Z',\r\n        description: 'Filter by updated_at date',\r\n    }),\r\n}).openapi({\r\n    title: 'GetCanvasQueryParams',\r\n    description: 'Query parameters for filtering and paginating canvases',\r\n});\r\n\r\n// Params validation schemas\r\nexport const GetCanvasByUidParamsSchema = z.object({\r\n    uid: CanvasSchema.shape.canvas_uid,\r\n}).openapi({\r\n    title: 'GetCanvasByUidParams',\r\n    description: 'URL params for getting a canvas by UID',\r\n});\r\n\r\nexport const CanvasIdParamsSchema = z.object({\r\n    id: z.string().regex(/^\\d+$/, 'ID must be a positive integer').openapi({\r\n        example: '1',\r\n        description: 'Canvas ID (numeric string)',\r\n    }),\r\n}).openapi({\r\n    title: 'CanvasIdParams',\r\n    description: 'URL params for canvas ID-based operations',\r\n});\r\n\r\n// --------------------\r\n// \uD83E\uDDE9 Types\r\n// --------------------\r\nexport type CanvasAttributes = z.infer<typeof CanvasSchema>;\r\nexport type CanvasCreationAttributes = z.infer<typeof CreateCanvasSchema>;\r\nexport type CanvasUpdateAttributes = z.infer<typeof UpdateCanvasSchema>;\r\nexport type CanvasQueryAttributes = z.infer<typeof GetCanvasQuerySchema>;\r\n\r\n// --------------------\r\n// \uD83E\uDDE9 Sequelize Model\r\n// --------------------\r\nexport class Canvas extends Model<CanvasAttributes, CanvasCreationAttributes> implements CanvasAttributes {\r\n    public id!: number;\r\n    public canvas_uid!: string;\r\n    public user_id!: number;\r\n    public note_id?: number | null;\r\n    public title!: string;\r\n    public canvas_data!: any;\r\n    public document_data!: Record<string, any>;\r\n    public viewport!: { scrollX?: number; scrollY?: number; zoom?: number } | null;\r\n    public pinned!: boolean;\r\n    public created_at!: Date;\r\n    public updated_at!: Date;\r\n    declare public note?: Note;\r\n}\r\n\r\nCanvas.init(\r\n    {\r\n        id: {\r\n            type: DataTypes.INTEGER,\r\n            autoIncrement: true,\r\n            primaryKey: true,\r\n            allowNull: false,\r\n        },\r\n        canvas_uid: {\r\n            type: DataTypes.STRING,\r\n            allowNull: false,\r\n            unique: true,\r\n        },\r\n        user_id: {\r\n            type: DataTypes.INTEGER,\r\n            allowNull: false,\r\n        },\r\n        note_id: {\r\n            type: DataTypes.INTEGER,\r\n            allowNull: true,\r\n            unique: true,\r\n            references: {\r\n                model: 'notes',\r\n                key: 'id',\r\n            },\r\n            onDelete: 'CASCADE',\r\n        },\r\n        title: {\r\n            type: DataTypes.TEXT,\r\n            allowNull: false,\r\n        },\r\n        canvas_data: {\r\n            type: DataTypes.JSON,\r\n            allowNull: true,\r\n            comment: 'Excalidraw elements JSON',\r\n        },\r\n        document_data: {\r\n            type: DataTypes.JSON,\r\n            allowNull: true,\r\n            comment: 'EditorJS content JSON',\r\n        },\r\n        viewport: {\r\n            type: DataTypes.JSON,\r\n            allowNull: true,\r\n            comment: 'Viewport state',\r\n        },\r\n        pinned: {\r\n            type: DataTypes.BOOLEAN,\r\n            allowNull: false,\r\n            defaultValue: false,\r\n        },\r\n        created_at: {\r\n            type: DataTypes.DATE,\r\n            allowNull: false,\r\n        },\r\n        updated_at: {\r\n            type: DataTypes.DATE,\r\n            allowNull: true,\r\n        },\r\n    },\r\n    {\r\n        sequelize,\r\n        tableName: 'canvases',\r\n        timestamps: false,\r\n        indexes: [\r\n            {\r\n                fields: ['canvas_uid'],\r\n                unique: true,\r\n            },\r\n            {\r\n                fields: ['user_id'],\r\n            }\r\n        ],\r\n    }\r\n);\r\n\r\nexport default Canvas;\r\n"],
  "mappings": "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",
  "names": ["sequelize"]
}
