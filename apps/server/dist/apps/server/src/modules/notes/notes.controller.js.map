{
  "version": 3,
  "sources": ["../../../../../../src/modules/notes/notes.controller.ts"],
  "sourcesContent": ["import { Request, Response } from \"express\";\r\nimport { errorHandler, successHandler } from \"../../common/middlewares/responseHandler\";\r\nimport { parseError } from \"../../common/utils/error.parser\";\r\nimport * as noteService from \"./notes.service\";\r\nimport { buildAllTags } from \"./notes.service\";\r\n\r\n// CRUD Operations\r\n\r\nexport const createNote = async (req: Request, res: Response) => {\r\n\ttry {\r\n\t\tif (!req.user || !req.user.userId) {\r\n\t\t\terrorHandler(res, \"Unauthorized\", {}, 401);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst userId = req.user.userId;\r\n\t\tconst note = await noteService.createNoteService(req.body, userId);\r\n\t\tsuccessHandler(res, \"Note created successfully\", note, 201);\r\n\t} catch (error) {\r\n\t\tconsole.error(\"Error creating note:\", error);\r\n\t\tconst errorParser = parseError(error);\r\n\t\terrorHandler(res, \"Failed to create note\", errorParser.message, errorParser.statusCode);\r\n\t}\r\n};\r\nexport const getAllNotes = async (req: Request, res: Response) => {\r\n\ttry {\r\n\t\tconst userId = req.user.userId;\r\n\r\n\t\t// Parse pagination parameters\r\n\t\tconst limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\r\n\t\tconst offset = req.query.offset ? parseInt(req.query.offset as string) : 0;\r\n\t\tconst search = req.query.search ? (req.query.search as string) : undefined;\r\n\t\tconst isWikilink = req.query.isWikiLink === 'true' || req.query.isWikiLink ? true : false;\r\n\t\tconst isGraph = req.query.isGraph === 'true' || req.query.isGraph ? true : false;\r\n\t\tconst isPinned = req.query.isPinned === 'true' || req.query.isPinned ? true : false;\r\n\r\n\t\tconst { notes, total } = await noteService.getAllNotesService(userId, limit, offset, search, isWikilink, isGraph, isPinned);\r\n\t\t// console.log('Notes retrieved:', notes);\r\n\t\t// console.log('Notes retrieved:', notes);\r\n\t\t// 1. Extract tags for each note\r\n\t\tconst mappedNotes = notes.map(note => {\r\n\t\t\tconst extractedTags = noteService.extractTagsFromContent(note.content);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tid: note.id,\r\n\t\t\t\ttitle: note.title,\r\n\t\t\t\tcontent: note.content,\r\n\t\t\t\ttags: extractedTags,\r\n\t\t\t\tnote_uid: note.note_uid,\r\n\t\t\t\tversion: note.version,\r\n\t\t\t\tpinned: note.pinned,\r\n\t\t\t\tchild_wikilinks: note.child_wikilinks || [],\r\n\t\t\t\tparent_wikilinks: note.parent_wikilinks || [],\r\n\t\t\t\tcreated_at: note.created_at,\r\n\t\t\t\tupdated_at: note.updated_at,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\r\n\t\t// console.log('Mapped notes:', mappedNotes);\r\n\t\tconst responseData = {\r\n\t\t\tnotes: mappedNotes,\r\n\t\t\tpagination: {\r\n\t\t\t\ttotal,\r\n\t\t\t\tlimit,\r\n\t\t\t\tremaining: total - (offset + limit),\r\n\t\t\t\tcurrentNoteCount: notes.length,\r\n\t\t\t\toffset,\r\n\t\t\t\tpageNum: Math.floor(offset / limit) + 1,\r\n\t\t\t\thasMore: offset + limit < total,\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn successHandler(res, \"Notes fetched successfully\", responseData, 200);\r\n\t} catch (error) {\r\n\t\tconsole.log(\"Error fetching notes:\", error);\r\n\t\tconst errorParser = parseError(error);\r\n\t\treturn errorHandler(res, \"Failed to fetch notes\", errorParser.message, errorParser.statusCode);\r\n\t}\r\n};\r\nexport const getAllTags = async (req: Request, res: Response) => {\r\n\ttry {\r\n\t\tconst userId = req.user.userId;\r\n\r\n\t\tconst page = req.query.page ? parseInt(req.query.page as string) : 1;\r\n\t\tconst limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\r\n\t\tconst offset = (page - 1) * limit;\r\n\r\n\t\t// STEP 1: Fetch ALL notes for the user (no pagination)\r\n\t\tconst { notes } = await noteService.getAllNotesService(userId);\r\n\r\n\t\t// STEP 2: Extract tags per note\r\n\t\tconst mappedNotes = notes.map(note => ({\r\n\t\t\tid: note.dataValues.id,\r\n\t\t\ttitle: note.dataValues.title,\r\n\t\t\tnote_uid: note.dataValues.note_uid,\r\n\t\t\ttags: noteService.extractTagsFromContent(note.dataValues.content),\r\n\t\t\tcreated_at: note.dataValues.created_at as Date,\r\n\t\t\tupdated_at: note.dataValues.updated_at as Date\r\n\t\t}));\r\n\r\n\t\t// STEP 3: Build global tag index\r\n\t\tconst allTags = buildAllTags(mappedNotes);\r\n\r\n\t\t// STEP 4: Apply pagination to tags\r\n\t\tconst paginatedTags = allTags.slice(offset, offset + limit);\r\n\r\n\t\treturn successHandler(res, \"Tags fetched successfully\", {\r\n\t\t\ttags: paginatedTags,\r\n\t\t\ttotal: allTags.length,\r\n\t\t\tpage,\r\n\t\t\tlimit\r\n\t\t}, 200);\r\n\r\n\t} catch (error) {\r\n\t\tconst parsed = parseError(error);\r\n\t\treturn errorHandler(res, \"Failed to fetch tags\", parsed.message, parsed.statusCode);\r\n\t}\r\n};\r\n\r\n\r\n\r\n\r\nexport const getNote = async (req: Request, res: Response) => {\r\n\ttry {\r\n\t\tconst userId = req.user.userId;\r\n\t\tconst uid = req.params.uid\r\n\t\tconsole.log('Fetching note with uid:', uid, 'for userId:', userId);\r\n\t\tconsole.log(\"req.params \", req.params)\r\n\r\n\r\n\t\tconst note = await noteService.getNoteByIdService(uid, userId);\r\n\r\n\t\tif (!note) {\r\n\t\t\treturn errorHandler(res, \"Note not found\", {}, 404);\r\n\t\t}\r\n\t\tconst extractedTags = noteService.extractTagsFromContent(note.content);\r\n\t\treturn successHandler(res, \"Note fetched successfully\", {\r\n\t\t\tid: note.id,\r\n\t\t\ttitle: note.title,\r\n\t\t\tuserId: note.user_id,\r\n\t\t\tcontent: note.content,\r\n\t\t\ttags: extractedTags,\r\n\t\t\tversion: note.version,\r\n\t\t\tnote_uid: note.note_uid,\r\n\t\t\tpinned: note.pinned,\r\n\t\t\tcreated_at: note.created_at,\r\n\t\t\tupdated_at: note.updated_at,\r\n\t\t\tchild_wikilinks: note.child_wikilinks,\r\n\t\t\tparent_wikilinks: note.parent_wikilinks,\r\n\r\n\t\t}, 200);\r\n\t} catch (error) {\r\n\t\tconst errorParser = parseError(error);\r\n\t\treturn errorHandler(res, \"Failed to fetch note\", errorParser.message, errorParser.statusCode);\r\n\t}\r\n};\r\n\r\nexport const updateNote = async (req: Request, res: Response) => {\r\n\ttry {\r\n\t\tconst userId = req.user.userId;\r\n\t\tconst id = parseInt(req.params.id);\r\n\t\tif (isNaN(id)) {\r\n\t\t\treturn errorHandler(res, \"Invalid note ID\", {}, 400);\r\n\t\t}\r\n\t\tconsole.log(\"Updating body \", req.body);\r\n\t\tconst note = await noteService.updateNoteService(id, req.body, userId);\r\n\t\tif (!note) {\r\n\t\t\treturn errorHandler(res, \"Note not found\", {}, 404);\r\n\t\t}\r\n\t\treturn successHandler(res, \"Note updated successfully\", {\r\n\t\t\tid: note.id,\r\n\t\t\ttitle: note.title,\r\n\t\t\tcontent: note.content,\r\n\t\t\ttags: note.tags,\r\n\t\t\tversion: note.version,\r\n\t\t\tpinned: note.pinned,\r\n\t\t\tcreated_at: note.created_at,\r\n\t\t\tupdated_at: note.updated_at,\r\n\t\t}, 200);\r\n\t} catch (error) {\r\n\t\tconsole.error(\"Error updating note:\", error);\r\n\t\tconst errorParser = parseError(error);\r\n\t\treturn errorHandler(res, \"Failed to update note\", errorParser.message, errorParser.statusCode);\r\n\t}\r\n};\r\n\r\nexport const deleteNote = async (req: Request, res: Response) => {\r\n\ttry {\r\n\t\tconst userId = req.user.userId;\r\n\t\tconst id = parseInt(req.params.id);\r\n\r\n\t\tif (isNaN(id)) {\r\n\t\t\treturn errorHandler(res, \"Invalid note ID\", {}, 400);\r\n\t\t}\r\n\r\n\t\tconst deleted = await noteService.deleteNoteService(id, userId);\r\n\r\n\t\tif (!deleted) {\r\n\t\t\treturn errorHandler(res, \"Note not found\", {}, 404);\r\n\t\t}\r\n\t\treturn successHandler(res, \"Note deleted successfully\", { deletedId: id }, 200);\r\n\t} catch (error) {\r\n\t\tconst errorParser = parseError(error);\r\n\t\treturn errorHandler(res, \"Failed to delete note\", errorParser.message, errorParser.statusCode);\r\n\t}\r\n};\r\n\r\n\r\n\r\n"],
  "mappings": "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",
  "names": []
}
