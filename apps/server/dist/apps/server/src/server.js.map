{
  "version": 3,
  "sources": ["../../../../src/server.ts"],
  "sourcesContent": ["import express from 'express';\r\nimport swaggerUi from 'swagger-ui-express';\r\nimport { combinedOpenApiDoc } from './common/docs';\r\nimport cors from 'cors';\r\nimport dotenv from 'dotenv';\r\nimport cookieParser from 'cookie-parser';\r\n\r\nimport userRoutes from './modules/users/user.route';\r\nimport assetRoutes from './modules/assets/asset.route';\r\nimport noteRoutes from './modules/notes/notes.route';\r\nimport canvasRoute from './modules/canvas/canvas.routes';\r\nimport qcRoute from './modules/quick-capture/qc.routes';\r\nimport aiRoute from './modules/ai/ai.route';\r\n\r\nimport redisClient, { connectRedis } from './config/redis';\r\n\r\n// Load env early\r\ndotenv.config();\r\n\r\nconst app = express();\r\n\r\n// middlewares\r\napp.use(express.json({ limit: '50mb' }));\r\napp.use(express.urlencoded({ extended: true, limit: '50mb' }));\r\napp.use(cookieParser());\r\napp.use(\r\n  cors({\r\n    origin: [\r\n      'http://localhost:8080',\r\n      'https://canvas-note.vercel.app',\r\n    ],\r\n    methods: ['GET', 'POST', 'PATCH', 'DELETE'],\r\n    credentials: true,\r\n  })\r\n);\r\n\r\n// ---- INIT SERVICES (SAFE FOR VERCEL) ----\r\nasync function initApp() {\r\n  try {\r\n    await connectRedis();\r\n    const result = await redisClient.ping();\r\n    console.log('Redis connected:', result);\r\n  } catch (err) {\r\n    console.error('Redis connection failed:', err);\r\n  }\r\n}\r\n\r\n// IMPORTANT: call but DO NOT await (serverless safe)\r\ninitApp();\r\n\r\n// background jobs\r\nimport './jobs/otp.worker';\r\n\r\n// ---- ROUTES ----\r\napp.get('/', (_req, res) => {\r\n  res.json({ status: 'ok', service: 'canvas-vault-api' });\r\n});\r\n\r\napp.use('/api-docs', swaggerUi.serve, swaggerUi.setup(combinedOpenApiDoc));\r\n\r\nconst apiV1 = '/api/v1';\r\napp.use(`${apiV1}/user`, userRoutes);\r\napp.use(`${apiV1}/assets`, assetRoutes);\r\napp.use(`${apiV1}/note`, noteRoutes);\r\napp.use(`${apiV1}/canvas`, canvasRoute);\r\napp.use(`${apiV1}/quick-capture`, qcRoute);\r\napp.use(`${apiV1}/ai`, aiRoute);\r\n\r\n\r\n\r\nconst port = process.env.PORT ? Number(process.env.PORT) : 3000;\r\n\r\napp.listen(port, () => {\r\n  console.log(`[ ready ] http://localhost:${port}`);\r\n});\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAAA,qBAAoB;AACpB,gCAAsB;AACtB,kBAAmC;AACnC,kBAAiB;AACjB,oBAAmB;AACnB,2BAAyB;AAEzB,kBAAuB;AACvB,mBAAwB;AACxB,mBAAuB;AACvB,oBAAwB;AACxB,gBAAoB;AACpB,gBAAoB;AAEpB,mBAA0C;AAqC1C,iBAAO;AAlCP,cAAAA,QAAO,OAAO;AAEd,MAAM,UAAM,eAAAC,SAAQ;AAGpB,IAAI,IAAI,eAAAA,QAAQ,KAAK,EAAE,OAAO,OAAO,CAAC,CAAC;AACvC,IAAI,IAAI,eAAAA,QAAQ,WAAW,EAAE,UAAU,MAAM,OAAO,OAAO,CAAC,CAAC;AAC7D,IAAI,QAAI,qBAAAC,SAAa,CAAC;AACtB,IAAI;AAAA,MACF,YAAAC,SAAK;AAAA,IACH,QAAQ;AAAA,MACN;AAAA,MACA;AAAA,IACF;AAAA,IACA,SAAS,CAAC,OAAO,QAAQ,SAAS,QAAQ;AAAA,IAC1C,aAAa;AAAA,EACf,CAAC;AACH;AAGA,eAAe,UAAU;AACvB,MAAI;AACF,cAAM,2BAAa;AACnB,UAAM,SAAS,MAAM,aAAAC,QAAY,KAAK;AACtC,YAAQ,IAAI,oBAAoB,MAAM;AAAA,EACxC,SAAS,KAAK;AACZ,YAAQ,MAAM,4BAA4B,GAAG;AAAA,EAC/C;AACF;AAGA,QAAQ;AAMR,IAAI,IAAI,KAAK,CAAC,MAAM,QAAQ;AAC1B,MAAI,KAAK,EAAE,QAAQ,MAAM,SAAS,mBAAmB,CAAC;AACxD,CAAC;AAED,IAAI,IAAI,aAAa,0BAAAC,QAAU,OAAO,0BAAAA,QAAU,MAAM,8BAAkB,CAAC;AAEzE,MAAM,QAAQ;AACd,IAAI,IAAI,GAAG,KAAK,SAAS,YAAAC,OAAU;AACnC,IAAI,IAAI,GAAG,KAAK,WAAW,aAAAC,OAAW;AACtC,IAAI,IAAI,GAAG,KAAK,SAAS,aAAAC,OAAU;AACnC,IAAI,IAAI,GAAG,KAAK,WAAW,cAAAC,OAAW;AACtC,IAAI,IAAI,GAAG,KAAK,kBAAkB,UAAAC,OAAO;AACzC,IAAI,IAAI,GAAG,KAAK,OAAO,UAAAC,OAAO;AAI9B,MAAM,OAAO,QAAQ,IAAI,OAAO,OAAO,QAAQ,IAAI,IAAI,IAAI;AAE3D,IAAI,OAAO,MAAM,MAAM;AACrB,UAAQ,IAAI,8BAA8B,IAAI,EAAE;AAClD,CAAC;",
  "names": ["dotenv", "express", "cookieParser", "cors", "redisClient", "swaggerUi", "userRoutes", "assetRoutes", "noteRoutes", "canvasRoute", "qcRoute", "aiRoute"]
}
